<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Number Guess Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 1rem;
            max-width: 600px;
            margin: auto;
            background: #fdf6e3;
        }
        h2, h3 {
            text-align: center;
        }

        .torn-paper {
            background: #fffdf6;
            padding: 1rem;
            margin: 1.5rem 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
        }

        .torn-paper:before, .torn-paper:after {
            content: "";
            position: absolute;
            width: 100%;
            height: 20px;
            left: 0;
            background: #fffdf6;
            z-index: 1;
        }
        .torn-paper:before {
            top: -10px;
            clip-path: polygon(0% 100%, 10% 0%, 20% 100%, 30% 0%, 40% 100%, 50% 0%, 60% 100%, 70% 0%, 80% 100%, 90% 0%, 100% 100%);
        }
        .torn-paper:after {
            bottom: -10px;
            clip-path: polygon(0% 0%, 10% 100%, 20% 0%, 30% 100%, 40% 0%, 50% 100%, 60% 0%, 70% 100%, 80% 0%, 90% 100%, 100% 0%);
        }

        .keypad {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 1rem 0;
        }
        .keypad button {
            width: 60px;
            height: 60px;
            margin: 5px;
            font-size: 1.5rem;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 10px;
        }
        .guess-display {
            font-size: 2rem;
            text-align: center;
            margin: 1rem 0;
            min-height: 2.5rem;
        }
        ul {
            list-style: none;
            padding: 0;
        }
        li {
            margin: 0.3rem 0;
            background: #eee;
            padding: 0.4rem;
            border-radius: 5px;
        }
        .clear-btn {
            background: #e74c3c;
        }
    </style>
</head>
<body>

<h2>üéØ Number Guess Game & Leaderboard</h2>

<div class="torn-paper">
    <h3>Start New Game</h3>
    <input type="number" id="digitCount" min="3" max="8" value="4">
    <button onclick="startGame(document.getElementById('digitCount').value)">Start Game</button>

    <div id="game" style="display:none;">
        <h3>Make Your Guess</h3>
        <div class="guess-display" id="guessDisplay"></div>
        <div class="keypad">
            <button onclick="addDigit('1')">1</button>
            <button onclick="addDigit('2')">2</button>
            <button onclick="addDigit('3')">3</button>
            <button onclick="addDigit('4')">4</button>
            <button onclick="addDigit('5')">5</button>
            <button onclick="addDigit('6')">6</button>
            <button onclick="addDigit('7')">7</button>
            <button onclick="addDigit('8')">8</button>
            <button onclick="addDigit('9')">9</button>
            <button onclick="addDigit('0')">0</button>
            <button class="clear-btn" onclick="clearGuess()">Clear</button>
            <button onclick="makeGuess()">Guess</button>
        </div>
        <ul id="history"></ul>
    </div>
</div>

<div class="torn-paper">
    <h3>üèÜ Leaderboard</h3>
    <ul id="leaderboardList"></ul>
</div>

<script>
let gameId = null;
let currentGuess = "";

async function startGame(digits) {
    const form = new FormData();
    form.append("num_digits", digits);
    const res = await fetch("/start_game", { method: "POST", body: form });
    const data = await res.json();
    gameId = data.game_id;
    document.getElementById("game").style.display = "block";
    document.getElementById("history").innerHTML = "";
    clearGuess();
    alert("Game started with " + digits + " digits!");
}

function addDigit(d) {
    currentGuess += d;
    document.getElementById("guessDisplay").textContent = currentGuess;
}

function clearGuess() {
    currentGuess = "";
    document.getElementById("guessDisplay").textContent = "";
}

async function makeGuess() {
    if (!gameId) {
        alert("Please start a game first.");
        return;
    }
    if (currentGuess.length !== parseInt(document.getElementById('digitCount').value)) {
        alert(`Please enter exactly ${document.getElementById('digitCount').value} digits.`);
        return;
    }

    const form = new FormData();
    form.append("game_id", gameId);
    form.append("guess", currentGuess);
    const res = await fetch("/guess", { method: "POST", body: form });
    const data = await res.json();

    const li = document.createElement("li");
    li.innerText = `Guess: ${currentGuess} ‚Üí In Number: ${data.numbers_correct}, Correct Place: ${data.positions_correct}`;
    document.getElementById("history").appendChild(li);

    if (data.completed) {
        alert("üéâ Congratulations! You guessed the number!");
    }
    clearGuess();
}


document.addEventListener("DOMContentLoaded", loadLeaderboard);

async function loadLeaderboard() {
    let res = await fetch("/leaderboard");
    let html = await res.text();
    let tmp = document.createElement("div");
    tmp.innerHTML = html;
    let players = tmp.querySelectorAll("tr");
    let list = document.getElementById("leaderboardList");
    list.innerHTML = "";
    players.forEach((row, idx) => {
        if(idx === 0) return; // skip header
        let cols = row.querySelectorAll("td");
        if(cols.length) {
            let li = document.createElement("li");
            li.textContent = `${cols[0].textContent} - ${cols[1].textContent} turns`;
            list.appendChild(li);
        }
    });
}
</script>

</body>
</html>
